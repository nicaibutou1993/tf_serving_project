#!/usr/bin/env python3
# -*- coding: utf-8 -*-
from __future__ import absolute_import
from __future__ import division
from __future__ import print_function

__author__ = 'luheng'

import tensorflow as tf
from tensorflow import keras
from parameters import configs
from load_data import build_dataset
num_oov_buckets = configs.num_oov_buckets
embed_size = configs.embedding_size
n_units = configs.num_units
n_epochs = configs.n_epochs
n_outputs = configs.n_outputs
lr = configs.learning_rate
test_path = 'data/test.txt'
vocab_path = 'data/vocab.txt'
# def vocab_func(vocab_path):
#     file_vocab = open(vocab_path,'r')
#     vocab = []
#     for line in file_vocab:
#         vocab.append(line.strip())
#     file_vocab.close()
#     return vocab
# def input_data_func(data_path,shuffle=False):
#     vocab = vocab_func(vocab_path)
#     input_data = build_dataset(data_path)
#     indices = tf.range(len(vocab), dtype=tf.int64)
#     table_init = tf.lookup.KeyValueTensorInitializer(vocab, indices)
#     table = tf.lookup.StaticVocabularyTable(table_init,num_oov_buckets)
#     def encode_words(X_batch, y_batch):
#         return table.lookup(X_batch), y_batch
#     input_data = input_data.map(encode_words).prefetch(1)
#     return input_data
# test_data = input_data_func(test_path)
# print("begin load")

def read_data(path):

    datas = []
    with open(path, 'r', encoding='utf-8') as f:
        datas = f.readlines()
    return datas
item2id = {'污': 2, '适': 3, '恢': 4, '时': 5, '版': 7, '荐': 679, '泡': 8, '票': 9, '侧': 10, '某': 875, '沒': 12, '病': 13, '扇': 14, '存': 15, '要': 16, '踢': 17, '锤': 18, '摸': 19, '母': 20, '途': 21, '哎': 22, '挂': 23, '室': 25, '酒': 26, 'X': 27, '耳': 30, '汗': 1442, '說': 32, '囊': 33, '呢': 288, '停': 35, '题': 36, '牛': 37, 'W': 290, '软': 39, '显': 40, '贼': 41, '做': 42, '故': 43, '贈': 44, '抓': 45, '断': 46, '问': 878, '国': 48, '買': 49, '俩': 50, '呸': 51, '诱': 52, '且': 53, '部': 1172, '西': 56, '清': 57, '渍': 58, '坏': 59, '龟': 60, '二': 61, '摆': 62, '另': 63, '虑': 1295, '校': 65, '周': 66, '减': 67, '毋': 68, '命': 70, '公': 71, '施': 72, '喇': 73, '直': 74, '术': 75, '蛋': 76, '策': 77, '陷': 78, '创': 79, '事': 80, '受': 81, '=': 82, '蜗': 83, '垃': 84, '忘': 85, '渠': 86, '溢': 87, '拜': 88, ';': 89, '岁': 1587, '跳': 90, '三': 91, '化': 92, '淅': 300, '艺': 94, '电': 95, '摊': 96, '~': 1224, '似': 97, 'B': 98, '质': 99, '信': 100, '瑞': 302, '闲': 102, '肋': 103, '柄': 104, '气': 105, '慕': 106, '购': 108, '绍': 883, '；': 110, '毛': 111, '被': 112, '胶': 113, '着': 114, '厌': 304, '涨': 116, '木': 117, '呵': 118, '源': 119, '模': 120, '因': 1456, '￣': 1724, '馈': 122, '性': 123, '赠': 124, '尖': 1444, '训': 125, '骂': 126, '抱': 127, '角': 128, '满': 129, '远': 130, '句': 131, '遥': 132, '频': 133, '棒': 134, '对': 135, '并': 136, '也': 137, '扯': 1420, '肤': 138, '虎': 139, '搞': 140, '蛮': 1358, '户': 142, '碰': 143, '還': 887, '丑': 145, '随': 146, '具': 147, '感': 148, '暗': 149, '常': 150, '何': 151, '骨': 152, '儿': 153, '舅': 154, '成': 155, '^': 156, '荣': 157, '观': 158, '纯': 159, '媳': 160, '泛': 161, '竟': 162, '弱': 163, '华': 164, '握': 165, '咨': 1020, '怕': 612, '识': 168, '富': 169, '冰': 170, '班': 171, '嗖': 172, '丢': 173, '坨': 174, '扭': 175, '。': 176, '分': 177, '价': 1467, '赚': 180, '城': 181, '徘': 183, '妥': 184, '芒': 185, '隐': 186, '惯': 187, '极': 188, '缘': 189, '给': 190, '懂': 1470, '吵': 192, '集': 193, '度': 194, '点': 195, '络': 196, '兔': 197, '除': 198, '滞': 199, '骚': 200, '历': 201, '限': 202, '晰': 203, '闻': 204, '猴': 205, '附': 206, '烂': 207, '请': 208, '损': 209, '索': 210, '念': 211, '辞': 212, '捿': 213, '尾': 214, '优': 215, '实': 216, '额': 217, '讯': 219, '劣': 308, '甸': 1360, '察': 222, '注': 223, '恶': 224, '撒': 1476, '之': 226, '犹': 227, '膜': 228, '第': 229, '纹': 230, '祝': 231, '环': 232, '家': 233, '昨': 234, '傍': 236, '街': 237, '】': 238, '串': 239, '颜': 240, '衷': 241, 'P': 626, '等': 428, '漂': 244, '盖': 245, '云': 246, '灰': 247, '浮': 248, '下': 249, '芯': 250, '药': 251, '灯': 252, '雅': 253, '盼': 254, '保': 255, '弯': 256, '厂': 257, '珑': 258, '汉': 259, 'K': 260, '略': 1515, '总': 261, '朋': 262, '瓶': 263, '齐': 911, '滴': 265, '泽': 266, '璃': 912, '稍': 268, 'u': 269, '裂': 270, '道': 272, '熟': 273, '位': 274, '库': 275, '账': 276, '波': 277, '住': 278, '境': 279, '拼': 280, '绝': 281, '测': 282, '废': 283, '歪': 285, '火': 287, '种': 34, 'h': 289, '强': 38, '抹': 291, '！': 292, '返': 293, '买': 294, '笔': 295, '近': 296, '伤': 297, '半': 298, '福': 635, '油': 93, '慌': 301, '把': 101, '可': 303, '局': 115, '顿': 305, '：': 306, '跟': 307, '易': 309, '饭': 310, '录': 311, 'c': 312, '哥': 313, '他': 314, '飘': 315, '圆': 1525, '积': 316, '挨': 317, '区': 637, '息': 319, '态': 1083, '亮': 321, '兼': 322, '套': 323, '悉': 923, '瑕': 325, '继': 326, '咯': 327, '符': 328, '杆': 329, '本': 330, '烟': 331, '动': 332, '梦': 333, '族': 334, '品': 335, '花': 336, '式': 337, '警': 338, '迷': 339, '长': 340, '而': 341, '午': 342, 'x': 343, '输': 1534, '耽': 344, '吗': 345, '礼': 346, '提': 347, '朵': 348, '脸': 349, '活': 350, '0': 351, '熄': 1225, '制': 1497, '逊': 354, '失': 451, '害': 356, '顺': 454, '进': 358, '响': 359, '纠': 360, '依': 468, '矩': 362, '潮': 363, '霉': 364, '候': 480, '剧': 366, '底': 367, '秒': 368, '管': 369, '县': 419, '军': 372, '误': 373, '消': 374, '广': 375, '希': 931, '掉': 377, '静': 378, '痛': 379, '配': 381, '引': 383, '亏': 384, '宗': 385, '`': 386, '四': 387, '助': 618, '体': 389, '速': 390, '开': 391, '谨': 1323, '查': 392, '发': 393, '订': 394, '已': 395, '使': 396, '审': 397, 'S': 398, '取': 399, '劲': 400, '吓': 401, '量': 402, '江': 403, '复': 404, '卖': 405, '特': 406, '秘': 407, '寄': 408, '带': 409, '客': 410, '义': 411, '收': 412, '万': 413, '麼': 414, '糊': 1507, '怜': 415, '字': 416, '趣': 417, '能': 1236, '终': 420, '形': 421, '乐': 422, '讨': 423, '免': 424, '肥': 425, '叹': 426, '投': 427, '壁': 429, '综': 430, '幻': 431, '蛇': 432, '任': 659, '顶': 434, '、': 435, '錯': 436, '喜': 437, '剩': 438, '换': 439, '小': 440, '腾': 897, '薄': 442, '忑': 443, '锐': 444, '包': 719, '仓': 446, '刷': 447, '拽': 1239, '很': 450, '鲁': 355, 'V': 452, '狭': 453, '@': 357, '了': 1605, '协': 455, '接': 456, '产': 1602, '卡': 457, '俺': 1513, '不': 459, '钱': 460, '议': 461, '機': 462, '衰': 463, '听': 464, '折': 465, '册': 466, '据': 467, '宿': 361, '琢': 469, '吹': 470, '炒': 471, '搪': 511, '装': 473, '欺': 1095, '雄': 1245, '遍': 476, '烫': 477, 'b': 478, '忍': 1142, '糟': 365, '店': 481, '9': 482, '購': 593, '睛': 1156, '舒': 484, '记': 485, '次': 1579, '没': 486, 'f': 1177, '词': 488, '则': 970, '工': 590, '确': 491, '淘': 492, '繁': 493, '手': 494, '砸': 1218, '…': 1493, 'p': 496, '铃': 1719, '突': 497, '吐': 1235, '还': 499, '闭': 500, '渐': 1248, '統': 502, 'I': 503, '凸': 1269, '悦': 851, '象': 506, '替': 507, '于': 508, '喽': 509, '离': 1585, '摄': 512, '全': 513, '嘻': 514, '幸': 515, '籍': 516, '弹': 517, '\ue00e': 518, '切': 519, '隙': 520, '揽': 521, '眼': 522, '纪': 523, '扎': 524, '线': 525, '篮': 526, ':': 527, '缝': 528, '懒': 529, '镜': 530, '边': 531, '节': 532, '览': 533, '无': 534, '超': 535, '贴': 536, '誉': 537, '宜': 538, '佼': 28, '技': 680, '乱': 541, '淀': 542, '留': 960, '夫': 544, '申': 545, '们': 546, '典': 547, '趟': 548, '诉': 549, '炸': 550, '评': 551, '星': 552, '安': 553, '疯': 554, '率': 555, '遗': 556, '累': 557, '逛': 558, '湿': 559, '白': 560, '情': 561, '單': 562, '七': 563, '倒': 564, '才': 565, '从': 566, '那': 567, '吻': 568, '終': 1690, '飞': 569, '银': 570, '必': 571, '苦': 572, '海': 573, '耍': 574, '天': 575, '否': 576, '团': 577, '务': 578, '都': 579, '脑': 580, '恰': 581, '疵': 582, '人': 583, 'g': 584, '姐': 585, '咱': 586, '询': 587, '奈': 588, '如': 589, '歌': 490, '担': 1671, '板': 591, '原': 592, '嗯': 64, '煮': 594, '南': 595, '至': 596, '例': 597, '需': 598, '闪': 599, '寝': 600, '阵': 601, '級': 602, '英': 603, '2': 604, 'r': 1564, '架': 605, '粘': 606, '味': 1265, '增': 1229, '空': 1723, '應': 609, '散': 610, '遮': 611, '理': 167, '单': 613, '推': 972, '玻': 615, '妇': 616, '文': 617, '科': 388, '入': 619, '狠': 620, '亲': 1717, '饱': 622, '供': 623, ')': 624, '越': 625, '省': 627, '薦': 628, '烦': 629, '答': 299, '善': 630, '细': 632, '急': 633, '水': 634, '厉': 178, '诚': 636, '续': 318, '归': 638, '项': 639, '官': 1271, '擦': 641, '同': 642, '肯': 643, '到': 644, '脱': 645, '（': 646, '鬼': 647, '隔': 648, '内': 649, '抬': 651, '妖': 652, '流': 653, '抗': 654, 'm': 655, '般': 656, '旁': 657, '麦': 658, '颖': 433, '黄': 660, '啊': 661, '果': 662, '．': 663, '调': 664, '划': 665, '晓': 666, '勾': 667, '望': 668, '效': 669, '美': 670, '既': 671, '机': 672, '京': 673, '这': 674, '贪': 675, '衡': 676, '戴': 677, '格': 678, '刻': 1233, '始': 540, '析': 1186, '苏': 682, '奉': 984, '达': 685, '责': 687, '批': 688, '徊': 689, '漆': 1446, '痕': 690, '剔': 691, '掌': 692, '承': 693, '说': 694, '刚': 695, '淡': 696, '℃': 697, '霸': 698, '降': 988, '判': 700, '犯': 701, '莱': 702, '捆': 1277, '捷': 703, '仪': 704, '愿': 706, '士': 707, '.': 708, '交': 709, '晒': 710, '裸': 711, '含': 712, '窄': 713, '自': 714, '现': 715, '青': 716, ',': 717, '读': 1424, '固': 718, '伏': 720, '完': 1484, 'J': 721, '男': 722, '氓': 723, '腿': 847, '坑': 725, '光': 726, '堆': 727, '☆': 1704, '兄': 728, '绳': 729, 'w': 730, '您': 731, '凑': 733, '条': 734, '扔': 735, '恋': 920, '杠': 737, '奋': 738, '音': 739, '孩': 740, '博': 928, '暖': 741, '山': 742, '置': 743, '阴': 744, '6': 745, '习': 746, '场': 747, '傻': 1559, '更': 906, '立': 749, '素': 750, '干': 1009, '剁': 752, 'U': 753, '师': 754, '通': 755, '雨': 756, '桌': 757, '靓': 758, '栏': 1043, '挺': 760, '铁': 761, '劝': 762, '盒': 763, '北': 764, '估': 765, '杜': 766, '盈': 767, '宇': 1562, '沪': 1096, '股': 770, '程': 771, '补': 772, '耶': 773, '止': 774, '由': 775, '容': 776, '敲': 777, '阳': 1130, '办': 779, '简': 781, '待': 782, '怪': 783, '洗': 784, '会': 785, '党': 1183, '谱': 787, '沾': 788, '严': 1001, '踏': 1210, '重': 791, '柔': 792, '尘': 793, '描': 794, '错': 795, '算': 796, '是': 797, '余': 1249, '德': 800, '耗': 801, '+': 802, '峰': 803, '松': 1287, '怎': 1568, '醉': 1290, '先': 807, '悍': 808, '有': 809, '便': 810, '啥': 1250, '刺': 812, '采': 813, '材': 1319, '右': 815, '扩': 816, '护': 817, '穷': 1362, '学': 819, '噱': 820, '沟': 821, '和': 822, '骁': 823, '副': 824, '绰': 825, '谢': 826, '豫': 827, '仍': 828, '甲': 829, '古': 830, 'Q': 831, '）': 832, '马': 833, '九': 834, '闹': 836, '赛': 837, '扛': 1036, '弟': 838, '吃': 840, '世': 841, '袋': 842, '但': 843, '竖': 844, '妹': 845, '豪': 846, '逗': 724, '卓': 848, '统': 849, '柜': 850, '束': 621, '嘴': 852, '低': 853, '众': 1155, '间': 855, '_': 856, '足': 857, '液': 858, '十': 859, '出': 860, '骄': 861, '8': 862, '帅': 863, '销': 864, '谁': 865, '左': 1681, '≦': 1071, '什': 866, '帧': 867, '射': 869, '腻': 870, 'N': 871, '迅': 872, '敏': 873, '温': 874, '赞': 11, '基': 876, '痴': 877, '用': 47, '控': 1583, '丁': 879, '缩': 880, '去': 882, '段': 109, '绑': 884, 'H': 885, 'M': 886, '添': 144, '戏': 888, '粹': 376, '掀': 1304, '私': 890, '击': 891, '呼': 892, '振': 893, '兰': 894, '就': 896, '让': 441, '巧': 898, '转': 899, '印': 900, '异': 681, '偷': 902, '蓄': 903, '战': 904, '暴': 905, '社': 811, '嘘': 907, '台': 908, '联': 909, '疼': 910, '外': 264, '准': 267, '利': 913, '该': 914, '哈': 915, '滋': 916, '两': 917, '曝': 918, '悔': 919, '普': 736, '缺': 922, '迫': 324, '法': 1437, '%': 924, '核': 925, '胡': 926, '弃': 927, '牌': 445, '功': 929, '爱': 930, '售': 371, '删': 932, '草': 933, '秀': 934, '址': 935, '*': 936, '夏': 937, '佳': 938, '楚': 939, '指': 940, '系': 941, '链': 942, '序': 943, '托': 944, '晃': 945, '惜': 946, '诡': 1582, '败': 947, '憾': 948, '【': 949, '想': 1591, '哪': 951, '风': 952, '撼': 953, '妙': 854, '大': 954, '连': 1592, '维': 956, '唯': 957, '新': 958, 'G': 959, '像': 543, '司': 961, '鸡': 1666, '许': 963, '拍': 964, '虽': 965, '领': 966, '仅': 967, '谅': 968, '差': 969, '纳': 971, '五': 614, '支': 973, '屎': 974, '生': 975, '域': 976, '睡': 977, '己': 978, '佬': 980, '冈': 981, '酱': 982, '箱': 983, '落': 684, '硬': 686, '坚': 986, '研': 987, '快': 699, '东': 989, '后': 990, '辨': 991, '拆': 992, '蠢': 993, '诺': 994, '险': 1599, '圈': 996, '括': 997, '\u3000': 998, '计': 999, '养': 1000, '头': 789, '糕': 242, 'e': 1002, '里': 1003, '抢': 1004, '噢': 1005, '滑': 1006, '遇': 818, '费': 1008, '放': 1699, '紧': 751, '钟': 1010, '建': 1011, '刮': 1012, '魔': 1013, '为': 1014, '辣': 1015, '书': 1016, '首': 1452, '千': 1017, '甩': 1018, '噻': 1019, '端': 166, '尬': 1021, '扫': 1022, '陆': 1023, '哑': 1024, '艳': 1025, '娘': 1027, '渣': 1351, '巅': 985, '迹': 1028, '按': 1029, '赶': 1463, '代': 1030, '几': 1031, '谓': 1032, '登': 1607, '月': 1608, 'Z': 1007, '早': 1037, '贬': 1038, '画': 1039, '面': 1044, '撕': 1041, '智': 1042, '共': 759, '教': 1040, '女': 1045, '喔': 1046, '甚': 1047, '负': 1048, '加': 1049, '爷': 1050, '签': 1051, '色': 1052, '专': 1053, '送': 1054, '宵': 1055, '反': 1056, 'q': 1057, '运': 1058, '平': 1059, 'O': 1060, '粒': 1702, '升': 1061, '廉': 1063, 'F': 1064, '為': 1065, '净': 1066, '回': 1067, '呆': 1068, '即': 1069, '短': 1070, '餐': 650, '爽': 1072, '皮': 1596, '戚': 1073, '尝': 1074, '忒': 1075, '罢': 1076, '狗': 1077, '拇': 1078, '磨': 1079, '主': 1080, '子': 1081, '幕': 1082, '横': 320, '玲': 1084, '狂': 1085, '?': 1086, '堵': 1087, '围': 472, '绿': 1639, '概': 1088, '步': 1089, '夕': 1090, '贝': 1092, '聊': 1093, '灵': 1094, 'y': 474, '力': 769, '弄': 1098, 'k': 1099, '设': 1100, '伪': 1487, '比': 1101, '夺': 1102, 'i': 1103, '叫': 1618, '偶': 1105, '合': 1106, '百': 1107, '铺': 1108, '将': 1109, '糙': 1110, '宝': 1111, '景': 881, '王': 1113, '期': 1114, '＋': 1115, '备': 1518, '忐': 1116, '上': 1481, '与': 1117, '口': 1118, '商': 1119, '轻': 1120, '背': 1121, '震': 1122, '片': 1621, '仿': 608, '帮': 1124, '毕': 1125, '打': 1126, '追': 1127, '付': 1128, '正': 1129, '经': 778, '呀': 1131, '匹': 1132, '路': 1133, '翘': 1134, '尴': 1135, '老': 1136, '屁': 1137, '畅': 1138, '庸': 1139, '队': 1140, '竹': 380, '营': 479, '舰': 1143, '仔': 1144, '喋': 1145, '拿': 1146, '藏': 1147, '拥': 1148, '巨': 1149, '诶': 1150, '逼': 1151, '少': 1152, '释': 1153, '组': 483, '阶': 1158, '一': 1159, 's': 748, '此': 1629, '兴': 1161, '改': 1162, '哒': 1163, '盲': 1164, '永': 1165, '叔': 1166, '称': 1168, '微': 1169, '莫': 1170, '7': 1171, '钝': 54, '兜': 1173, '颗': 1174, '敷': 1175, '杀': 1176, '若': 487, '业': 1178, '又': 1179, '番': 1180, '参': 1181, '浪': 786, '伙': 1184, '垫': 1185, '及': 806, '拉': 489, '裹': 1187, '深': 1188, '贵': 1189, '压': 1190, '粉': 1191, '思': 1478, '唰': 1192, '况': 1193, '睬': 1195, '砂': 1196, '告': 1197, '练': 1198, '选': 1199, '艹': 1200, '扬': 1201, '致': 1202, '拒': 1355, '撇': 1204, '抖': 1356, '相': 1206, '传': 1207, '车': 1208, '神': 1209, '摔': 1211, '级': 1212, '撤': 1213, '弥': 1214, '瘦': 1215, '映': 1216, '晨': 1217, '撑': 495, '距': 1219, '碎': 1220, '哦': 1221, '件': 1222, '张': 1502, '來': 1194, '寒': 1346, '非': 352, '证': 1226, '凉': 1227, '根': 1228, '玩': 1230, '猫': 1231, '良': 1232, '界': 1234, '所': 498, '今': 418, '球': 1237, '內': 1238, '尺': 449, '晚': 1240, '居': 1242, '磁': 1243, '验': 1244, '卸': 475, '3': 1246, '圳': 1247, '最': 501, '或': 798, '框': 1251, '案': 1252, '惊': 1253, '抠': 1254, '够': 1255, '各': 1645, '困': 1257, '逸': 1258, '冒': 1260, '摁': 1261, '拟': 1262, '作': 1263, '乘': 1264, '酸': 607, '，': 1266, '状': 1267, '移': 1268, '检': 504, '蓝': 1270, '▽': 640, '个': 1272, '骗': 1273, '年': 1274, '忠': 1275, '威': 1276, '懵': 505, '刘': 1278, '磕': 1279, '者': 1280, '促': 1281, '努': 1282, '意': 1283, '脾': 1284, '撞': 1285, '得': 1286, '友': 804, '当': 1288, '捣': 1289, '萌': 1291, '详': 1292, '割': 1293, '视': 1294, '久': 835, '健': 1667, '示': 1653, '我': 1296, '筒': 1297, '炫': 1298, '零': 1299, '盛': 1300, '塞': 1301, '搜': 1302, '哇': 1303, '变': 889, '解': 1305, '瞬': 1306, '瘾': 1589, '值': 1307, '网': 1308, '激': 1309, '嘛': 1310, '八': 1311, '操': 1312, '尔': 1313, '行': 1369, '抵': 1315, '持': 1316, '游': 1317, '述': 1318, '跌': 814, '密': 1320, '物': 1321, '修': 1371, '款': 1141, '规': 1324, '名': 1325, '旧': 1326, '叭': 1327, '4': 1329, '只': 1330, '宁': 1331, '触': 1333, '父': 1334, '虚': 1335, '衍': 1336, '硅': 1337, '靠': 1338, '六': 1339, '展': 1340, '求': 1341, '脆': 1342, '喷': 1343, '貌': 1344, '择': 1345, '资': 1347, '造': 1348, '漏': 1349, '走': 1182, '导': 1352, '语': 1353, '丽': 1354, '忽': 1203, '彩': 1205, '递': 1692, '鼠': 1357, '吧': 220, '傲': 1359, '起': 221, 'E': 1361, '你': 1363, '太': 1364, '怀': 1365, '耀': 1366, 'C': 1367, '扣': 1368, '孔': 1314, '身': 1370, '却': 790, '插': 1322, '启': 1372, '预': 1373, '毫': 1374, '唉': 1375, '见': 1376, '禁': 1377, '获': 1378, '鸟': 1379, '伴': 1380, '沙': 1381, '精': 1382, '愧': 1383, 'n': 1384, '隆': 1385, '临': 1386, '充': 1387, '未': 1388, '!': 1389, '挡': 1390, '魅': 1391, '偏': 1392, '钢': 1157, '斑': 1394, '透': 1395, '｀': 1396, '宽': 1397, '范': 1398, '烈': 1399, '菜': 1400, '1': 1401, '攀': 1402, '咋': 1403, '志': 1404, '‖': 1405, '金': 1406, '斯': 1407, '润': 1670, '允': 1091, '在': 1411, '影': 1412, '亚': 1413, '稀': 1415, 'R': 1416, '洁': 1417, '整': 1418, '凌': 1419, '沫': 979, '纤': 1421, '吊': 1422, '填': 1423, '考': 1410, '香': 1425, '跑': 1426, '真': 539, '溜': 1428, '酷': 1112, '爆': 1430, '市': 1431, '盘': 1641, 'v': 1672, '稳': 1433, '坐': 1434, '啦': 1435, '滚': 1436, '档': 6, '瞎': 1438, '勉': 1439, '言': 1440, '厚': 1441, '池': 31, "'": 1443, '砖': 631, '中': 1445, '排': 799, '须': 683, '方': 1448, '屌': 1676, '知': 1450, '结': 1451, '约': 1393, '郁': 1453, '决': 1454, '苹': 1455, '民': 1540, '措': 121, '～': 1457, '么': 1458, '丰': 1459, ' ': 1460, '以': 1461, '/': 1462, '防': 962, '布': 1679, '洋': 1465, '退': 1466, '→': 179, '愤': 1468, '倍': 1469, '-': 191, '爸': 1471, '冷': 1472, '员': 1473, '看': 1474, '些': 1475, '障': 225, '处': 1477, '挑': 235, '耐': 1479, '脚': 1223, '绚': 1480, '默': 69, '播': 1482, 'T': 1483, '予': 1259, '介': 1485, '拖': 1486, '克': 286, '势': 1488, '？': 1489, '堪': 1490, '享': 1427, '烧': 1492, '丝': 107, '定': 1494, '夸': 1495, '闷': 1496, '崩': 353, '红': 141, '镀': 1498, '好': 1499, '碍': 1500, '较': 1501, '婆': 382, '熬': 1503, '辛': 1504, '拾': 1505, '探': 1506, '(': 243, '兆': 1508, '呦': 1509, '愉': 1510, '欢': 1511, '盟': 1512, '门': 458, '试': 1514, '歹': 921, '壳': 1516, '搭': 1517, '心': 510, '嘎': 1519, '慎': 1520, '际': 1521, '妈': 1522, '的': 1524, 'd': 1328, '财': 1526, '载': 1527, '恐': 1528, '派': 1529, '催': 1530, '邮': 1531, '础': 1532, '她': 448, '槽': 182, '華': 1154, '来': 1536, '再': 1537, '难': 1538, '陋': 1539, '尽': 1034, '醒': 1491, 't': 1542, '属': 1543, '锁': 1544, '休': 1545, '恼': 1546, '高': 1547, '目': 1548, 'o': 1549, '敌': 1550, '其': 1551, '储': 1552, '#': 1553, 'D': 1554, '每': 1555, '农': 1556, '类': 1557, '％': 1558, '页': 1409, '寸': 1560, '慢': 1561, '报': 768, '枝': 1563, '惠': 780, '石': 1565, '米': 1566, '悠': 1567, '找': 805, '舍': 1569, '热': 1570, '尤': 1571, '乎': 1572, '宣': 1573, '斜': 1701, '过': 1575, '麟': 1533, '航': 1576, '斗': 1577, '纸': 1578, '疑': 1241, '翻': 1580, '恭': 1581, '日': 55, '黑': 895, '奔': 1584, '层': 901, '政': 1586, '沉': 1350, '它': 1588, '武': 1097, '森': 1590, '龙': 950, '独': 955, '呗': 1593, '\\': 1535, '焦': 1594, '麒': 1595, '⊙': 29, '阔': 1696, '货': 1598, '紫': 995, '塑': 1600, '痒': 1601, '延': 1167, '赵': 1603, 'l': 1604, '话': 1026, '旗': 1606, '器': 1033, '赖': 1035, '5': 1609, '露': 1610, '仙': 1611, '趁': 1612, '迟': 1613, '冲': 1614, '往': 1615, '占': 1616, '地': 1617, '笑': 1332, '服': 1619, '史': 1620, '桶': 1123, 'L': 1622, '哭': 1624, '关': 1625, '悲': 1626, '论': 1627, '牙': 1447, '讲': 1628, '码': 1160, '初': 1630, '究': 1631, '衣': 1632, 'A': 1633, '敢': 1634, '标': 1635, '声': 1636, '前': 1637, '吸': 1638, '圾': 868, '向': 1640, '豆': 218, '巴': 1642, '媒': 1643, '涂': 1644, '欲': 1256, '塌': 1646, '尿': 1647, '坛': 1648, 'z': 1649, '封': 1650, '别': 1651, '幅': 1652, '数': 705, '浏': 1654, '觉': 1655, '杂': 1656, '辈': 1657, '表': 1658, '份': 1659, '明': 1660, '給': 1661, '粗': 1662, '假': 1663, '站': 1664, '讶': 1665, '怨': 271, '均': 284, '破': 1668, '敬': 1669, '截': 1408, '争': 1414, '列': 1432, '死': 1673, '尚': 1674, '键': 1675, '元': 1449, '夜': 1677, '麻': 1678, '群': 1464, '谈': 1680, '嘿': 1429, '双': 1682, '逆': 1683, '屏': 1684, '忙': 1685, '避': 1686, '悬': 1687, '针': 1688, '应': 1689, '奇': 839, '鲜': 1691, '春': 1523, '图': 1693, '多': 1694, '＾': 1695, '残': 1541, '★': 1697, '携': 1709, '认': 1698, '庆': 1062, '然': 1700, '料': 1574, '洞': 370, '冬': 1597, '楼': 1705, '令': 1706, '写': 1707, '样': 1708, '型': 1623, '券': 1710, '汰': 1711, '曲': 1712, 'a': 1713, '哟': 1714, '葩': 1715, '照': 1716, '号': 1104, '鸥': 1718, '暂': 24, '块': 1720, '寨': 1721, '脏': 1722, '≧': 1703, '顾': 732, '守': 1725, '厘': 1726, '嫌': 1727}

dev_data = read_data('data/dev.txt')

import numpy as np
batch_y = []
batch_x = []
for i,d in enumerate(dev_data):
    if i > 100:
        break
    target,context = d.split('|')

    batch_y.append(int(target))
    batch_x.append([item2id.get(c,1) for c in context.strip()])



def sequence_padding(inputs, length=None, padding=0):
    """Numpy函数，将序列padding到同一长度
    """
    if length is None:
        length = max([len(x) for x in inputs])

    pad_width = [(0, 0) for _ in np.shape(inputs[0])]
    outputs = []
    for x in inputs:
        x = x[:length]
        pad_width[0] = (0, length - len(x))
        x = np.pad(x, pad_width, 'constant', constant_values=padding)
        outputs.append(x)

    return np.array(outputs)

batch_y = np.array(batch_y)

batch_x = sequence_padding(batch_x)

import tensorflow
saved_model = tensorflow.keras.models.load_model("my_keras_model_check.h5")
print("end load begin evaluate!!!!!!!!!!!!!!!!!")
y_pred = saved_model.predict(batch_x)

print(y_pred)
print((np.argmax(y_pred,axis=1) == batch_y).sum() / len(batch_y))

